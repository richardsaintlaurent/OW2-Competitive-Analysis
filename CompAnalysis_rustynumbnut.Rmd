---
title: "rustynumbnut"
---

```{r include=FALSE}
#Libraries
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
library(ggbeeswarm)
library(forcats)
library(reshape2)
library(ggpubr)
library(formattable)
library(rmarkdown)
library(car)

#Map Types
payload <- c("Havana", "Shambali", "Circuit Royale", "Junkertown", "Rialto", "Dorado", "Gibraltar", "Route 66")
push <- c("Esperanca", "New Queen St", "Colosseo")
control <- c("Lijiang Tower", "Oasis", "Antarctica", "Illios", "Nepal", "Busan")
hybrid <- c("Paraiso", "Blizzard World", "King's Row", "Numbani", "Midtown", "Eichenwalde", "Hollywood")

#Rank Factor
ranklevels <- c("Unranked",
                "B1", "B2", "B3", "B4", "B5",
                "S1", "S2", "S3", "S4", "S5",
                "G5", "G4", "G3", "G2", "G1",
                "P5", "P4", "P3", "P2", "P1",
                "D5","D4","D3","D2","D1",
                "M5","M4","M3","M2","M1",
                "GM5","GM4","GM3","GM2","GM1")

#Week Factor
weeklevels <- c("Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sun")

#Different data sets
richard <- "https://docs.google.com/spreadsheets/u/1/d/e/2PACX-1vR_9gIef6ZVgMa-wXYan3Z3rP7I7-HCn6G9exUCkAiGx2fIFRspvAQWxZU7_0GOAOD9NCTdbUGCHt0z/pub?output=csv"
vixx <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vR9hsqrKzPQ2rJbYwHOG1rcFRUssXK8rVb0HFDT6Jz3a3B0tQVy4P1vW7AfI88jWw/pub?output=csv"

#Load in data
comp <- read.csv(richard, na.strings = c("", "NA")) %>%
  mutate(BinWin = ifelse(Result == "Win", 1,
                         ifelse(Result == "Draw", 0.5, 0)),
         Weekday = factor(weekdays(as.Date(Date,"%m/%d/%Y"), abbreviate = T), levels = weeklevels),
         TankRank = factor(TankRank, levels = ranklevels),
         DpsRank = factor(DpsRank, levels = ranklevels),
         SuppRank = factor(SuppRank, levels = ranklevels),
         LobbyRank = factor(LobbyRank, levels = ranklevels),
         Tank = as.numeric(sub("<", "", Tank)),
         Dps = as.numeric(sub("<", "", Dps)),
         Support = as.numeric(sub("<", "", Support)),
         Hour = paste0(format(strptime(Time, "%I:%M:%S %p"), "%H"),
                        ".", 
                        round(100*as.numeric(format(strptime(Time, "%I:%M:%S %p"), "%M"))/60)),
         TankGT = paste0(Season, ".", sprintf("%02d", TankTour)),
         DpsGT = paste0(Season, ".", sprintf("%02d", DpsTour)),
         SuppGT = paste0(Season, ".", sprintf("%02d", SuppTour)),
         MapType = ifelse(Map %in% payload, "Payload",
                          ifelse(Map %in% push, "Push",
                                 ifelse(Map %in% control, "Control",
                                        ifelse(Map %in% hybrid, "Hybrid", NA)))),
         TimeBracket = ifelse(as.numeric(Hour) >= 12 & as.numeric(Hour) < 17, "Afternoon",
                              ifelse(as.numeric(Hour) >= 17 & as.numeric(Hour) < 24, "Evening",
                                     ifelse(as.numeric(Hour) >= 0 & as.numeric(Hour) < 8, "Night",
                                            ifelse(as.numeric(Hour) >= 8 & as.numeric(Hour) < 12, "Morning", NA)))),
         RankMatch = ifelse(Role == "Tank", 
                            as.numeric(TankRank) - as.numeric(LobbyRank),
                            ifelse(Role == "DPS", 
                                   as.numeric(DpsRank) - as.numeric(LobbyRank), 
                                   as.numeric(SuppRank) - as.numeric(LobbyRank))),
         Underdog = ifelse(RankMatch < 0, "Underdog",
                           ifelse(RankMatch > 0, "Favoured", "Exact"))) %>%
  relocate(Notes, .after = last_col())

comp <- comp[-52,]

comp_canc <- filter(comp, Result != "Cancelled") %>%
  arrange(Role)
```

```{r, echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
rolesummary <-
  comp %>%
  filter(Result != "Cancelled") %>%
  group_by(Role) %>%
  summarize(GamesPlayed = length(Role),
            Winrate = sum(BinWin)/length(BinWin),
            Enjoyment = mean(Enjoyment)) %>%
  mutate(across(3:4, round, 2))

mapsummary <-
  comp %>%
  filter(Result != "Cancelled") %>%
  group_by(MapType) %>%
  summarize(GamesPlayed = length(BinWin),
            Winrate = sum(BinWin)/length(BinWin),
            Enjoyment = mean(Enjoyment)) %>%
  arrange(., desc(Winrate)) %>%
  mutate(across(3:4, round, 2))

map_winrate <-
  comp %>%
  filter(Result != "Cancelled") %>%
  group_by(Map, MapType) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            #TankWait = mean(Tank, na.rm=T),
            #DpsWait = mean(Dps, na.rm=T),
            #SuppWait = mean(Support, na.rm=T),
            n = length(BinWin)) %>%
  ggplot(., aes(x= fct_reorder(Map, Winrate), y = Winrate, fill = MapType, label = n)) +
  geom_col() +
  scale_fill_manual(values = c("darkgrey", "#E69F00", "steelblue", "#009E73")) +
  coord_flip() +
  geom_hline(yintercept = 50, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  scale_y_continuous(limits = c(0,100)) +
  geom_text(hjust = -0.4, vjust = 0.4, size = 3.25) +
  labs(y = "Winrate", x = "Map") +
  ggtitle("Map Winrate", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))

map_enjoyment <-
  comp %>%
  filter(Result != "Cancelled") %>%
  group_by(Map, MapType) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            #TankWait = mean(Tank, na.rm=T),
            #DpsWait = mean(Dps, na.rm=T),
            #SuppWait = mean(Support, na.rm=T),
            n = length(BinWin)) %>%
  ggplot(., aes(x= fct_reorder(Map, Enjoyment), y = Enjoyment, fill = MapType, label = n)) +
  geom_col() +
  scale_fill_manual(values = c("darkgrey", "#E69F00", "steelblue", "#009E73")) +
  coord_flip() +
  geom_hline(yintercept = 2.5, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  scale_y_continuous(limits = c(0,5)) +
  geom_text(hjust = -0.4, vjust = 0.4, size = 3.25) +
  labs(y = "Enjoyment", x = "Map") +
  ggtitle("Map Enjoyment", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5))
```

**Role summary**
```{r echo=FALSE, warning=FALSE, message = FALSE}
paged_table(rolesummary, options = NULL)
```

**Map type summary**
```{r echo=FALSE, warning=FALSE, message = FALSE}
paged_table(mapsummary, options = NULL)
```

**Map Rankings**
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
ggarrange(map_winrate, map_enjoyment, common.legend = TRUE, legend = "bottom")
#print(map_winrate)
#print(map_enjoyment)
```

**Enjoyment & Result Bias**\
Winrate and enjoyment are strongly correlated
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
#Enjoyment beeswarm
comp %>%
  #filter(Result != "Draw") %>%
  mutate(Role_Result = paste0(Role, "_", Result)) %>%
  ggplot(., aes(y = Enjoyment, x = Role, colour = Result)) +
  scale_colour_manual(values = c("darkgrey", "#E69F00", "#d1495b", "#009E73")) +
  #geom_violin() +
  geom_beeswarm(alpha = 0.5) +
  ggtitle("Enjoyment Distribution") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "top")

comp %>%
  filter(Result != "Cancelled" & Result != "Draw") %>%
  ggplot(., aes(x = Enjoyment, y = BinWin)) +
  geom_jitter(height = 0.025, alpha = 0.65) +
  geom_smooth(method="glm", method.args=list(family="binomial"),
              colour = "steelblue", se = T) +
  labs(y = "Result") +
  ggtitle("Result Bias", subtitle = "Draws removed; 1 = Win, 0 = Loss") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

**Variability throughout the week**
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
#Winrate and Enjoyment per day
wrtperday <-
  comp %>%
  group_by(Weekday) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            n = length(BinWin)) %>%
  ggplot(., aes(x = as.numeric(Weekday), y = Winrate, label = n)) +
  geom_hline(yintercept = 50, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  geom_point(aes(y = Winrate, colour = "Winrate"), size = 2, alpha = 0.5) +
  geom_point(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 2, alpha = 0.5) +
  geom_line(aes(y = Winrate, colour = "Winrate"), size = 0.75, alpha = 0.5) +
  geom_line(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 0.75, alpha = 0.5) +
  geom_text(hjust = 0.5, vjust = -0.5, colour = "black") +
  scale_x_continuous(breaks = c(1:7), labels = levels(comp$Weekday)) +
  scale_y_continuous(limits = c(0,100), sec.axis = sec_axis(trans=~./20, name="Enjoyment")) +
  labs(x = "Weekday", colour = "") +
  ggtitle("Winrate & Enjoyment Throughout The Week", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "top")

print(wrtperday)
```

**Does winrate vary throughout the week?**
```{r echo=FALSE, warning=FALSE, message = FALSE}
model <-
  comp %>%
  group_by(Weekday = as.factor(Weekday)) %>%
  summarize(Win = sum(BinWin),
            Loss = length(BinWin) - sum(BinWin)) %>%
  glm(cbind(Win, Loss) ~ Weekday, 
      data = ., family = binomial)
Anova(model)
```

**Flex queue: Role probability throughout the week**
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
#Role prob per weekday
comp %>%
  filter(Queue == "Flex") %>%
  group_by(Weekday, Role) %>%
  summarise(Count = length(Role)) %>%
  ungroup() %>%
  group_by(Weekday) %>%
  mutate(Total = sum(Count),
         RoleProb = Count/Total) %>%
  ggplot(., aes(x = "", y = Count, fill = Role)) + 
  geom_bar(stat = "identity", position = position_fill()) +
  geom_text(aes(label = Count), position = position_fill(vjust = 0.5)) +
  coord_polar(theta = "y") +
  facet_wrap(~Weekday, nrow = 2) +
  theme_bw() +
  labs(x = "Weekday", y = "Role Probability") +
  ggtitle("Flex Queue Role Probability Throughout The Week") +
  theme(axis.text.x=element_blank(), axis.ticks.x=element_blank(),
        axis.text.y=element_blank(), axis.ticks.y=element_blank(),
        legend.position = "top",
        plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
comp %>%
  filter(Result != "Draw" & Result != "Cancelled") %>%
  mutate(Hour = ifelse(as.numeric(Hour) < 1, (as.numeric(Hour) + 24), Hour)) %>%
  ggplot(., aes(x = as.numeric(Hour), y = BinWin)) +
  geom_hline(yintercept = 0.5, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  geom_jitter(width = 0, height = 0.01, alpha = 0.5) +
  geom_smooth(colour = "steelblue", se = F) +
  ylim(-0.01,1.01) +
  scale_x_continuous(labels = scales::label_number(accuracy = 0.01),
                     breaks = c(9:24)) +
  labs(x = "Time of Day (24hr)", y = "Winrate") +
  ggtitle("Predicted Winrate from Time of Day", subtitle = "Draws removed; 1 = Win, 0 = Loss") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```

**Does winrate vary between time of day?**\
Morning: 8AM <= Time < 12PM\
Afternoon: 12PM <= Time < 5PM\
Evening: 5PM <= Time < 12AM\
Night: 12AM <= Time < 8AM\
```{r echo=FALSE, warning=FALSE, message = FALSE}
model <-
  comp %>%
  group_by(TimeBracket) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            GamesPlayed = length(BinWin),
            Won = sum(BinWin),
            Lost = length(BinWin) - sum(BinWin)) %>%
  glm(cbind(Won, Lost) ~ TimeBracket, 
      data = ., family = binomial)
Anova(model)
```

**Lobby Rank vs Actual Rank**\
Rank disparity is calculated from (ActualRank - LobbyRank)\
Therefore, positive disparity is Favoured, negative disparity is Underdog\
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
lobbyrankplot <-
  comp %>%
  filter(Result != "Cancelled") %>%
  select("LobbyRank", "BinWin", "Enjoyment") %>%
  na.omit() %>%
  group_by(LobbyRank) %>%
  summarize(Winrate = 100*sum(BinWin)/length(BinWin),
            Enjoyment = mean(Enjoyment),
            GamesPlayed = length(BinWin),
            Won = sum(BinWin),
            Lost = length(BinWin) - sum(BinWin)) %>%
  arrange(., LobbyRank) %>%
  mutate(across(2:3, round, 2)) %>%
  ggplot(., aes(x = as.numeric(LobbyRank), y = Winrate, label = GamesPlayed)) +
  geom_hline(yintercept = 50, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  geom_point(aes(y = Winrate, colour = "Winrate"), size = 2, alpha = 0.5) +
  geom_point(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 2, alpha = 0.5) +
  geom_line(aes(y = Winrate, colour = "Winrate"), size = 0.75, alpha = 0.5) +
  geom_line(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 0.75, alpha = 0.5) +
  geom_text(hjust = 0.5, vjust = -0.5) +
  scale_y_continuous(limits = c(0,100), sec.axis = sec_axis(trans=~./20, name="Enjoyment")) +
  scale_x_continuous(labels = levels(comp$LobbyRank), breaks = 1:length(levels(comp$LobbyRank))) +
  labs(x = "Lobby Rank", colour = "Legend") +
  ggtitle("Winrate & Enjoyment for Lobby Rank", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "top")

rankdisparityplot <-
  comp %>%
  select("RankMatch", "Underdog", "BinWin", "Enjoyment") %>%
  na.omit() %>%
  group_by("RankDisparity" = RankMatch) %>%
  summarize(Winrate = 100*sum(BinWin)/length(BinWin),
            Enjoyment = mean(Enjoyment),
            GamesPlayed = length(BinWin),
            Won = sum(BinWin),
            Lost = length(BinWin) - sum(BinWin)) %>%
  arrange(., Winrate) %>%
  mutate(across(2:3, round, 2)) %>%
  ggplot(., aes(x = RankDisparity, y = Winrate, label = GamesPlayed)) +
  geom_hline(yintercept = 50, colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  geom_vline(xintercept = 0, colour = "black", size = 1, linetype = "dashed", alpha = 0.5) +
  geom_point(aes(y = Winrate, colour = "Winrate"), size = 2, alpha = 0.5) +
  geom_point(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 2, alpha = 0.5) +
  geom_line(aes(y = Winrate, colour = "Winrate"), size = 0.75, alpha = 0.5) +
  geom_line(aes(y = Enjoyment*20, colour = "Enjoyment"), size = 0.75, alpha = 0.5) +
  geom_text(hjust = 0.5, vjust = -0.5) +
  scale_y_continuous(limits = c(0,100), sec.axis = sec_axis(trans=~./20, name="Enjoyment")) +
 #scale_x_continuous(labels = levels(comp$LobbyRank), breaks = 1:length(levels(comp$LobbyRank))) +
  labs(x = "Rank-Lobby Disparity", colour = "Legend") +
  ggtitle("Rank Disparity Winrate & Enjoyment", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5),
        legend.position = "top")

ggarrange(lobbyrankplot, rankdisparityplot, common.legend = TRUE, legend = "bottom")
```

```{r echo=FALSE, warning=FALSE, message = FALSE}
#Calculate if last game was win or loss 
#last_result <- rep(NA, length(comp_canc$BinWin))
#for(row in 2:length(comp_canc$BinWin)){
#  result <- ifelse(comp_canc$BinWin[(row-1)] == 1, "Last Won", "Last Lost")
#  last_result[row] <- result
#}

##Calculate Win/loss streaks OVERALL
#Number of consecutive results to constitute a streak (n):
#n <- 3
#streak_result <- rep(NA, length(comp_canc$BinWin))
#for(row in (n+1):length(comp_canc$BinWin)){
#  result <- ifelse(sum(comp_canc$BinWin[(row-(n-1)):(row)]) == n, "Win streak",
#                   ifelse(sum(comp_canc$BinWin[(row-(n-1)):(row)]) == 0, "Loss streak", "No streak"))
#  streak_result[row] <- result
#}

##Calculate Win/loss streaks RANK DEPENDENT
#DPS
n <- 3
dps_result <- rep(NA, length(subset(comp_canc, Role == "DPS")$BinWin))
for(row in (n+1):length(subset(comp_canc, Role == "DPS")$BinWin)){
  result <- ifelse(sum(subset(comp_canc, Role == "DPS")$BinWin[(row-(n-1)):(row)]) == n, "Win streak",
                   ifelse(sum(subset(comp_canc, Role == "DPS")$BinWin[(row-(n-1)):(row)]) == 0, "Loss streak", "No streak"))
  dps_result[row] <- result
}
#Support
supp_result <- rep(NA, length(subset(comp_canc, Role == "Support")$BinWin))
for(row in (n+1):length(subset(comp_canc, Role == "Support")$BinWin)){
  result <- ifelse(sum(subset(comp_canc, Role == "Support")$BinWin[(row-(n-1)):(row)]) == n, "Win streak",
                   ifelse(sum(subset(comp_canc, Role == "Support")$BinWin[(row-(n-1)):(row)]) == 0, "Loss streak", "No streak"))
  supp_result[row] <- result
}
#Tank
tank_result <- rep(NA, length(subset(comp_canc, Role == "Tank")$BinWin))
for(row in (n+1):length(subset(comp_canc, Role == "Tank")$BinWin)){
  result <- ifelse(sum(subset(comp_canc, Role == "Tank")$BinWin[(row-(n-1)):(row)]) == n, "Win streak",
                   ifelse(sum(subset(comp_canc, Role == "Tank")$BinWin[(row-(n-1)):(row)]) == 0, "Loss streak", "No streak"))
  tank_result[row] <- result
}

rank_streak <- c(dps_result, supp_result, tank_result)
```

**Lobby Summary**\
A "streak" is defined by 3 consecutive wins or losses.\
If you queue when you're on a streak, what are the quality of the lobbies you get?\

WinStreak_n = Number of games played while on a win streak\
LossStreak_n = Number of games played while on a loss streak\

%WinStreak = Percent of Win streak games played\
%LossStreak = Percent of Loss streak games played\
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
winstreak <- 
  comp_canc %>%
  cbind(rank_streak) %>%
  select("rank_streak", "RankMatch", "Underdog", "BinWin", "Enjoyment", "Role") %>%
  na.omit() %>%
  group_by("Condition" = Underdog) %>%
  summarize(Winrate = 100*sum(BinWin)/length(BinWin),
            Enjoyment = mean(Enjoyment),
            GamesPlayed = length(BinWin),
            WinStreak_n = length(which(rank_streak == "Win streak")),
            LossStreak_n = length(which(rank_streak == "Loss streak"))) %>%
  ungroup() %>%
  mutate("%WinStreak" = 100*WinStreak_n/sum(WinStreak_n),
         "%LossStreak" = 100*LossStreak_n/sum(LossStreak_n)) %>%
  arrange(., Winrate) %>%
  mutate(across(2:8, round, 2))

paged_table(winstreak, options = NULL)
```

**Rank over time**\
A "tour" is in reference to the win-loss record in-game, where either 5 wins or 15 losses are needed to readjust rank\
Example: Tour 4.12 means Season 4, tour 12
```{r echo=FALSE, warning=FALSE, message = FALSE, fig.width = 10}
#Tank Rank over time
tankrank.time <-
  comp %>%
  filter(Role == "Tank" & DpsRank != "Unranked") %>%
  group_by(TankGT) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            WaitTime = mean(Tank),
            TankRank = TankRank,
            n = length(BinWin)) %>%
  unique() %>%
  arrange(TankGT) %>%
  ggplot(., aes(x = TankGT, y = as.numeric(TankRank), colour = Winrate, label = n)) +
  geom_point() +
  geom_path(group=1) +
  geom_text(hjust = 0.5, vjust = -0.5) +
  scale_y_continuous(labels = levels(comp$TankRank), breaks = 1:length(levels(comp$TankRank))) +
  scale_color_gradient(low = "red", high = "green", limits = c(0,100)) +
  geom_vline(xintercept = "3.08", colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  labs(y = "Rank", x = "Season.Tour") +
  ggtitle("Tank Rank", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        panel.grid.minor = element_blank())

#DPS Rank over time
dpsrank.time <-  
  comp %>%
  filter(Role == "DPS" & DpsRank != "Unranked") %>%
  group_by(DpsGT) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            WaitTime = mean(Dps),
            DpsRank = DpsRank,
            n = length(BinWin)) %>%
  unique() %>%
  arrange(DpsGT) %>%
  ggplot(., aes(x = DpsGT, y = as.numeric(DpsRank), colour = Winrate, label = n)) +
  geom_point() +
  geom_path(group=1) +
  geom_text(hjust = 0.5, vjust = -0.5) +
  scale_y_continuous(labels = levels(comp$DpsRank), breaks = 1:length(levels(comp$DpsRank))) +
  scale_color_gradient(low = "red", high = "green", limits = c(0,100)) +
  geom_vline(xintercept = "3.10", colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  labs(y = "Rank", x = "Season.Tour") +
  ggtitle("DPS Rank", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        panel.grid.minor = element_blank())

#Support Rank over time
supprank.time <-  
  comp %>%
  filter(Role == "Support" & SuppRank != "Unranked") %>%
  group_by(SuppGT) %>%
  summarize(Enjoyment = mean(Enjoyment),
            Winrate = 100*sum(BinWin)/length(BinWin),
            #WaitTime = mean(Supp),
            SuppRank = SuppRank,
            n = length(BinWin)) %>%
  unique() %>%
  arrange(SuppGT) %>%
  ggplot(., aes(x = SuppGT, y = as.numeric(SuppRank), colour = Winrate, label = n)) +
  geom_point() +
  geom_path(group=1) +
  geom_text(hjust = 0.5, vjust = -0.5) +
  scale_y_continuous(labels = levels(comp$SuppRank), breaks = 1:length(levels(comp$SuppRank))) +
  scale_color_gradient(low = "red", high = "green", limits = c(0,100)) +
  geom_vline(xintercept = "3.02", colour = "darkred", size = 1, linetype = "dashed", alpha = 0.5) +
  labs(y = "Rank", x = "Season.Tour") +
  ggtitle("Support Rank", subtitle = "Labels = sample size") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5), 
        plot.subtitle = element_text(hjust = 0.5),
        panel.grid.minor = element_blank())

print(tankrank.time)
print(dpsrank.time)
print(supprank.time)
```